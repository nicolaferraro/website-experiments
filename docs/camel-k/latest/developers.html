<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer&#8217;s Guide :: Camel K</title>
    <link rel="canonical" href="https://www.nicolaferraro.me/website-experiments/camel-k/latest/developers.html">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.nicolaferraro.me/website-experiments">Camel K</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="camel-k" data-version="latest">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Apache Camel K</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="index.html">Camel K</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation-minikube.html">Minikube</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation-minishift.html">Minishift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation-gke.html">Google Kubernetes Engine (GKE)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apache Camel K</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apache Camel K</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Apache Camel K</a></li>
    <li class="crumb"><a href="developers.html">Developer&#8217;s Guide</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/nicolaferraro/camel-k/edit/antora/docs/modules/ROOT/pages/developers.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Developer&#8217;s Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We love contributions!</p>
</div>
<div class="paragraph">
<p>The project is written in <a href="https://golang.org/">go</a> and contains some parts written in Java for the <a href="/runtime">integration runtime</a>
Camel K is built on top of Kubernetes through <strong>Custom Resource Definitions</strong>. The <a href="https://github.com/operator-framework/operator-sdk">Operator SDK</a> is used
to manage the lifecycle of those custom resources.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements"><a class="anchor" href="#requirements"></a>Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to build the project, you need to comply with the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Go version 1.10+</strong>: needed to compile and test the project. Refer to the <a href="https://golang.org/">Go website</a> for the installation.</p>
</li>
<li>
<p><strong>Dep version 0.5.0</strong>: for managing dependencies. You can find installation instructions in the <a href="https://github.com/golang/dep">dep GitHub repository</a>.</p>
</li>
<li>
<p><strong>Operator SDK v0.0.7+</strong>: used to build the operator and the Docker images. Instructions in the <a href="https://github.com/operator-framework/operator-sdk">Operator SDK website</a> (binary downloads available in the release page).</p>
</li>
<li>
<p><strong>GNU Make</strong>: used to define composite build actions. This should be already installed or available as package if you have a good OS (<a href="https://www.gnu.org/software/make/" class="bare">https://www.gnu.org/software/make/</a>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="checks"><a class="anchor" href="#checks"></a>Running checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Checks rely on <code>golangci-lint</code> being installed, to install it look at the <a href="https://github.com/golangci/golangci-lint#local-installation">Local Installation</a> instructions.</p>
</div>
<div class="paragraph">
<p>You can run checks via <code>make lint</code> or you can install a GIT pre-commit hook and have the checks run via <a href="https://pre-commit.com">pre-commit</a>; then make sure to install the pre-commit hooks after installing pre-commit by running</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ pre-commit install</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="checking-out"><a class="anchor" href="#checking-out"></a>Checking Out the Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can create a fork of this project from Github, then clone your fork with the <code>git</code> command line tool.</p>
</div>
<div class="paragraph">
<p>You need to put the project in your $GOPATH (refer to <a href="https://golang.org/doc/install">Go documentation</a> for information).
So, make sure that the <strong>root</strong> of the github repo is in the path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$GOPATH/src/github.com/apache/camel-k/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="structure"><a class="anchor" href="#structure"></a>Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a high level overview of the project structure:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Structure</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/cmd">/cmd</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the entry points (the <strong>main</strong> functions) for the <strong>camel-k</strong> binary and the <strong>kamel</strong> client tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/build">/build</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains scripts used during make operations for building the project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/deploy">/deploy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains Kubernetes resource files that are used by the <strong>kamel</strong> client during installation. The <code>/deploy/resources.go</code> file is kept in sync with the content of the directory (<code>make build-embed-resources</code>), so that resources can be used from within the go code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/docs">/docs</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains this documentation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/pkg">/pkg</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where the code resides. The code is divided in multiple subpackages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/runtime">/runtime</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Java runtime code that is used inside the integration Docker containers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/test">/test</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include integration tests to ensure that the software interacts correctly with Kubernetes and OpenShift.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/tmp">/tmp</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scripts and Docker configuration files used by the operator-sdk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/vendor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project dependencies (not staged in git).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/version">/version</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the global version of the project.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="building"><a class="anchor" href="#building"></a>Building</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Go dependencies in the <strong>vendor</strong> directory are not included when you clone the project.</p>
</div>
<div class="paragraph">
<p>Before compiling the source code, you need to sync your local <strong>vendor</strong> directory with the project dependencies, using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>make dep</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>make dep</code> command runs <code>dep ensure -v</code> under the hood, so make sure that <code>dep</code> is properly installed.</p>
</div>
<div class="paragraph">
<p>To build the whole project you now need to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>make</code></pre>
</div>
</div>
<div class="paragraph">
<p>This execute a full build of both the Java and Go code. If you need to build the components separately you can execute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>make build-operator</code>: to build the operator binary only.</p>
</li>
<li>
<p><code>make build-kamel</code>: to build the <code>kamel</code> client tool only.</p>
</li>
<li>
<p><code>make build-runtime</code>: to build the Java-based runtime code only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After a successful build, if you&#8217;re connected to a Docker daemon, you can build the operator Docker image by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>make images</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="anchor" href="#testing"></a>Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unit tests are executed automatically as part of the build. They use the standard go testing framework.</p>
</div>
<div class="paragraph">
<p>Integration tests (aimed at ensuring that the code integrates correctly with Kubernetes and OpenShift), need special care.</p>
</div>
<div class="paragraph">
<p>The <strong>convention</strong> used in this repo is to name unit tests <code>xxx_test.go</code>, and name integration tests <code>yyy_integration_test.go</code>.
Integration tests are all in the <a href="/test">/test</a> dir.</p>
</div>
<div class="paragraph">
<p>Since both names end with <code>_test.go</code>, both would be executed by go during build, so you need to put a special <strong>build tag</strong> to mark
integration tests. A integration test should start with the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// +build integration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look into the <a href="/test">/test</a> directory for examples of integration tests.</p>
</div>
<div class="paragraph">
<p>Before running a integration test, you need to be connected to a Kubernetes/OpenShift namespace.
After you log in into your cluster, you can run the following command to execute <strong>all</strong> integration tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>make test-integration</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running"><a class="anchor" href="#_running"></a>Running</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to install everything you have in your source code and see it running on Kubernetes, you need to run the following command:</p>
</div>
<div class="sect2">
<h3 id="_for_minishift"><a class="anchor" href="#_for_minishift"></a>For Minishift</h3>
<div class="ulist">
<ul>
<li>
<p>Run <code>make install-minishift</code> (or just <code>make install</code>): to build the project and install it in the current namespace on Minishift</p>
</li>
<li>
<p>You can specify a different namespace with <code>make install-minishift project=myawesomeproject</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command assumes you have an already running Minishift instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_for_minikube"><a class="anchor" href="#_for_minikube"></a>For Minikube</h3>
<div class="ulist">
<ul>
<li>
<p>Run <code>make install-minikube</code>: to build the project and install it in the current namespace on Minikube</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command assumes you have an already running Minikube instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use"><a class="anchor" href="#_use"></a>Use</h3>
<div class="paragraph">
<p>Now you can play with Camel K:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./kamel run examples/Sample.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add additional dependencies to your routes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./kamel run -d camel:dns examples/dns.js</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debugging"><a class="anchor" href="#debugging"></a>Debugging and Running from IDE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes it&#8217;s useful to debug the code from the IDE when troubleshooting.</p>
</div>
<div class="paragraph">
<div class="title"><strong>Debugging the <code>kamel</code> binary</strong></div>
<p>It should be straightforward: just execute the <a href="/cmd/kamel/main.go">/cmd/kamel/main.go</a> file from the IDE (e.g. Goland) in debug mode.</p>
</div>
<div class="paragraph">
<div class="title"><strong>Debugging the operator</strong></div>
<p>It is a bit more complex (but not so much).</p>
</div>
<div class="paragraph">
<p>You are going to run the operator code <strong>outside</strong> OpenShift in your IDE so, first of all, you need to <strong>stop the operator running inside</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// use kubectl in plain Kubernetes
oc scale deployment/camel-k-operator --replicas 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can scale it back to 1 when you&#8217;re done and you have updated the operator image.</p>
</div>
<div class="paragraph">
<p>You can setup the IDE (e.g. Goland) to execute the <a href="/cmd/camel-k/main.go">/cmd/camel-k/main.go</a> file in debug mode.</p>
</div>
<div class="paragraph">
<p>When configuring the IDE task, make sure to add all required environment variables in the <strong>IDE task configuration screen</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>KUBERNETES_CONFIG</code> environment variable to point to your Kubernetes configuration file (usually <code>&lt;homedir&gt;/.kube/config</code>).</p>
</li>
<li>
<p>Set the <code>WATCH_NAMESPACE</code> environment variable to a Kubernetes namespace you have access to.</p>
</li>
<li>
<p>Set the <code>OPERATOR_NAME</code> environment variable to <code>camel-k</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you setup the IDE task, you can run and debug the operator process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The operator can be fully debugged in Minishift, because it uses OpenShift S2I binary builds under the hood.
The build phase cannot be (currently) debugged in Minikube because the Kaniko builder requires that the operator and the publisher pod
share a common persistent volume.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
